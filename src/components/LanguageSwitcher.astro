---
/**
 * Language Switcher Component
 * ===========================
 * Compact dropdown for language selection.
 *
 * - Shows current locale code
 * - Dropdown with all available languages
 *
 * Labels are taken from localeLabels config, or fallback to uppercase code.
 */

import { localeLabels, type Locale } from "@/i18n";

interface Props {
  locale: Locale;
  alternates?: Record<string, string>;
}

const { locale, alternates = {} } = Astro.props;

const currentLabel = localeLabels[locale] ?? locale.toUpperCase();

// Build options from alternates (shows only what's available)
const options = Object.entries(alternates)
  .filter(([code]) => code !== locale)
  .map(([code, href]) => ({
    code,
    label: localeLabels[code as Locale] ?? code.toUpperCase(),
    href,
  }));

// Sort alphabetically
options.sort((a, b) => a.code.localeCompare(b.code));
---

{Object.keys(alternates).length > 1 && (
  <div class="lang-switcher">
    <span class="lang-current">{currentLabel}</span>
    {options.length > 0 && (
      <div class="lang-dropdown">
        {options.map((opt) => (
          <a href={opt.href} class="lang-option">{opt.label}</a>
        ))}
      </div>
    )}
  </div>
)}

<style>
  .lang-switcher {
    position: relative;
    font-size: 0.8rem;
  }

  .lang-current {
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    color: var(--text-muted, #666);
  }

  .lang-current::after {
    content: " â–¾";
    font-size: 0.7em;
  }

  .lang-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--bg, #fff);
    border: 1px solid var(--border, #eee);
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    min-width: 120px;
    z-index: 100;
  }

  .lang-switcher:hover .lang-dropdown,
  .lang-switcher:focus-within .lang-dropdown {
    display: block;
  }

  .lang-option {
    display: block;
    padding: 0.5rem 0.75rem;
    color: var(--text-muted, #666);
    text-decoration: none;
    white-space: nowrap;
  }

  .lang-option:hover {
    background: var(--bg-code, #f5f5f5);
    color: var(--text, #222);
  }
</style>

