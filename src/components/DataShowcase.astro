---
import { getTopOpportunities, getPerformanceTrend, getDataSummary } from "@/lib/data";

const opportunities = getTopOpportunities(3);
const trend = getPerformanceTrend();
const summary = getDataSummary();
---

<section class="data-showcase">
  <div class="summary">
    <div>
      <p class="label">Avg. CPA Across Test Partners</p>
      <p class="value">{summary.avgCpa.toFixed(2)} USD</p>
    </div>
    <div>
      <p class="label">Fastest Approval Window</p>
      <p class="value">{summary.fastestApproval} days</p>
    </div>
    <div>
      <p class="label">Best Recorded CTR</p>
      <p class="value">{summary.bestCtr}%</p>
    </div>
  </div>

  <div class="grid">
    <article class="card">
      <h3>Launch-ready Programs</h3>
      <p>Translatable sample data seeded via <code>make seed</code>.</p>
      <ul>
        {opportunities.map((item) => (
          <li>
            <strong>{item.program}</strong> 路 {item.vertical} 路 {item.network}
            <br />
            <span>CPT ${item.avgCpa} 路 Approvals in {item.approvalTimeDays} days 路 Focus geo: {item.topGeo}</span>
          </li>
        ))}
      </ul>
    </article>

    <article class="card">
      <h3>Performance Pulse</h3>
      <table>
        <thead>
          <tr>
            <th>Month</th>
            <th>CTR%</th>
            <th>EPC</th>
            <th>Top Region</th>
          </tr>
        </thead>
        <tbody>
          {trend.slice(-4).map((point) => (
            <tr>
              <td>{point.month}</td>
              <td>{point.ctr}%</td>
              <td>{`$${point.epc}`}</td>
              <td>{point.topRegion}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </article>
  </div>
</section>

<style>
  .data-showcase {
    margin: 2rem 0;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  .summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1rem;
  }
  .summary .label {
    font-size: 0.75rem;
    text-transform: uppercase;
    color: var(--text-light, #666);
  }
  .summary .value {
    font-size: 1.25rem;
    font-weight: 600;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1rem;
  }
  .card {
    border: 1px solid var(--border, #eee);
    border-radius: 8px;
    padding: 1rem;
    background: var(--bg-card, #fff);
  }
  .card h3 {
    margin-bottom: 0.5rem;
  }
  .card ul {
    list-style: none;
    padding: 0;
  }
  .card li {
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border, #f0f0f0);
    font-size: 0.9rem;
  }
  .card li:last-child {
    border-bottom: none;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }
  th,
  td {
    padding: 0.35rem 0.25rem;
    text-align: left;
    border-bottom: 1px solid var(--border, #f0f0f0);
  }
  code {
    font-size: 0.85em;
  }
</style>
