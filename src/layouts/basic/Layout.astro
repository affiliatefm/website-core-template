---
import { getRelativeLocaleUrl } from "astro:i18n";
import { t, toHreflang } from "@/i18n";
import { defaultLanguage, type LanguageCode, siteUrl } from "@/config/site";

interface Props {
  title: string;
  description?: string;
  language: LanguageCode;
  hreflangUrls?: Record<string, string>;
}

const { title, description, language, hreflangUrls = {} } = Astro.props;
const canonicalUrl = hreflangUrls[language] ?? `${siteUrl}${Astro.url.pathname}`;
const xDefaultUrl = hreflangUrls[defaultLanguage] ?? canonicalUrl;
const hasMultipleLanguages = Object.keys(hreflangUrls).length > 1;
const ui = t(language);
---

<!doctype html>
<html lang={toHreflang(language)}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}
    <link rel="canonical" href={canonicalUrl} />
    {hasMultipleLanguages && Object.entries(hreflangUrls).map(([lang, url]) => (
      <link rel="alternate" hreflang={toHreflang(lang)} href={url} />
    ))}
    {hasMultipleLanguages && <link rel="alternate" hreflang="x-default" href={xDefaultUrl} />}
  </head>
  <body>
    <header><a href={getRelativeLocaleUrl(language, "")}>{ui.homeLabel}</a></header>
    <main><slot /></main>
    <footer><a href="https://affiliate.fm">Affiliate.FM</a></footer>
  </body>
</html>

<style is:global>
:root { --text: #374151; --dim: #6b7280; --muted: #9ca3af; --accent: #3b82f6; --line: #e5e7eb; --bg: #f9fafb; }
* { margin: 0; padding: 0; box-sizing: border-box; }
html { font: 14px/1.6 system-ui, sans-serif; color: var(--text); background: #fff; }
body { max-width: 560px; margin: 0 auto; padding: 2rem 1rem; }
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }
header, footer { font-size: 13px; color: var(--dim); }
header { margin-bottom: 1.5rem; }
header a, footer a { color: var(--dim); }
header a:hover, footer a:hover { color: var(--text); text-decoration: none; }
main { min-height: 60vh; }
footer { margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--line); }
h1 { font-size: 1.4rem; font-weight: 600; margin-bottom: 0.75rem; line-height: 1.3; }
h2 { font-size: 1rem; font-weight: 600; margin: 1.5rem 0 0.5rem; color: var(--dim); }
h3 { font-size: 0.9rem; font-weight: 600; margin: 1rem 0 0.25rem; }
p, ul, ol { margin-bottom: 0.75rem; }
ul, ol { padding-left: 1.25rem; }
li { margin-bottom: 0.15rem; }
code { font: 0.85em ui-monospace, monospace; background: var(--bg); padding: 0.1em 0.3em; border-radius: 3px; }
pre { background: #1f2937; color: #f9fafb; padding: 0.75rem 1rem; border-radius: 6px; overflow-x: auto; margin-bottom: 1rem; font-size: 12px; }
pre code { background: none; padding: 0; }
hr { border: none; border-top: 1px solid var(--line); margin: 1.5rem 0; }
table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; font-size: 13px; }
th, td { padding: 0.4rem 0.5rem; text-align: left; border-bottom: 1px solid var(--line); }
th { font-weight: 500; font-size: 12px; color: var(--muted); }
td:last-child { text-align: right; }
.center { text-align: center; }
.muted { color: var(--muted); }
.dim { color: var(--dim); }
.hero { font-size: 3rem; font-weight: 600; color: var(--line); line-height: 1; margin-bottom: 0.5rem; }
.spacer { padding: 3rem 0; }
.small { font-size: 12px; }
</style>
