---
import { getRelativeLocaleUrl } from "astro:i18n";
import { t, toHreflang } from "@/i18n";
import { defaultLanguage, type LanguageCode, siteUrl } from "@/config/site";

interface Props {
  title: string;
  description?: string;
  language: LanguageCode;
  hreflangUrls?: Record<string, string>;
}

const {
  title,
  description,
  language,
  hreflangUrls = {},
} = Astro.props;
const canonicalUrl = hreflangUrls[language] ?? `${siteUrl}${Astro.url.pathname}`;
const xDefaultUrl = hreflangUrls[defaultLanguage] ?? canonicalUrl;
const hasMultipleLanguages = Object.keys(hreflangUrls).length > 1;
const ui = t(language);
const siteHost = new URL(siteUrl).hostname;
---

<!doctype html>
<html lang={toHreflang(language)}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title} | {siteHost}</title>
    {description && <meta name="description" content={description} />}
    <link rel="canonical" href={canonicalUrl} />
    {Object.entries(hreflangUrls).map(([lang, url]) => (
      <link rel="alternate" hreflang={toHreflang(lang)} href={url} />
    ))}
    {hasMultipleLanguages && (
      <link rel="alternate" hreflang="x-default" href={xDefaultUrl} />
    )}
  </head>
  <body>
    <header><a href={getRelativeLocaleUrl(language, "")}>{ui.homeLabel}</a></header>
    <main><slot /></main>
    <footer>Â© {new Date().getFullYear()} {siteHost}</footer>
  </body>
</html>

<style is:global>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font: 15px/1.6 system-ui, sans-serif;
    color: #222;
    max-width: 640px;
    margin: 0 auto;
    padding: 0 1.25rem;
  }

  a { color: #05f; text-decoration: none; }
  a:hover { text-decoration: underline; }

  h1 { font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; }
  p { margin-bottom: 0.75rem; }

  header { padding: 1rem 0; border-bottom: 1px solid #eee; }
  header a { color: #666; font-weight: 500; }
  header a:hover { color: #222; text-decoration: none; }
  main { padding: 1.5rem 0; min-height: 60vh; }
  footer { padding: 1rem 0; border-top: 1px solid #eee; font-size: 0.8rem; color: #999; }
</style>
