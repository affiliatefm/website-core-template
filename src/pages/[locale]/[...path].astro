---
/**
 * Non-default locale pages
 * Handles: /ru, /ru/o-nas, /ru/docs/getting-started
 */

import { getCollection, render } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { locales, defaultLocale, getLocaleFromId, getUrlSlug, getAlternateUrls, type Locale } from "@/i18n";

export async function getStaticPaths() {
  const allPages = await getCollection("pages", ({ data }) => !data.draft);
  const nonDefaultLocales = locales.filter((l) => l !== defaultLocale);
  
  const paths = [];
  
  for (const locale of nonDefaultLocales) {
    const localePages = allPages.filter((page) => page.id.startsWith(`${locale}/`));
    
    for (const entry of localePages) {
      paths.push({
        params: { 
          locale,
          path: getUrlSlug(entry) || undefined,
        },
        props: { entry, locale, allPages },
      });
    }
  }

  return paths;
}

const { entry, locale, allPages } = Astro.props;
const { Content } = await render(entry);
const alternates = getAlternateUrls(entry, allPages);
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  locale={locale}
  alternates={alternates}
>
  <Content />
</BaseLayout>
